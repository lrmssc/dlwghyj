////  SeasonWin.cpp//  dianliwangguomanyouji////  Created by szsycx on 3/17/15.////#include "SeasonWin.h"#include "ui/cocosGUI.h"#include "CastleScene.h"#include "LevelScene.h"#include "Tail.h"using namespace cocos2d::ui;bool SeasonWin::init(){    if(!Layer::init()){        return false;    }        bool isMusicPlay = UserDefault::getInstance()->getBoolForKey("music",true);    if(isMusicPlay){            CocosDenshion::SimpleAudioEngine::getInstance()->preloadBackgroundMusic("seasonwin/seasonwin.mp3");        CocosDenshion::SimpleAudioEngine::getInstance()->playBackgroundMusic("seasonwin/seasonwin.mp3", false);    }            Size visibleSize = Director::getInstance()->getVisibleSize();    int currentSeason = UserDefault::getInstance()->getIntegerForKey("current_season",1);    auto title = Sprite::create(StringUtils::format("seasonwin/t%d.png",currentSeason));    title->setPosition(Vec2(visibleSize.width/2.0,visibleSize.height-title->getContentSize().height));   // addChild(title);    String seasonName;    switch(currentSeason){        case 1:            seasonName = "通过安全超市!!恭喜";            break;        case 2:seasonName = "通过加工厂!!恭喜";            break;        case 3:seasonName = "通过花园小区!!恭喜";            break;        case 4:seasonName = "通过抢修大队!!恭喜";            break;        case 5:seasonName = "通过电力医院!!恭喜";            break;        case 6:seasonName = "通过黑森林!!恭喜";            break;    }    String mName =UserDefault::getInstance()->getStringForKey("name", "小明");    seasonName.append(mName.getCString());    auto name = Text::create(seasonName.getCString(), "fonts/zhongwen.ttf", 70);    name->setPosition(Vec2(visibleSize.width*5.0/10.0,visibleSize.height*9.0/10.0));    addChild(name);    count = 1;    for(int i = 0; i<6;i++){                int temp = UserDefault::getInstance()->getIntegerForKey(StringUtils::format("max_level%d",(i+1)).c_str(),0);        if(temp==12){            continue;        }else{            count = 0;            break;        }    }                    auto enermyren = Sprite::create(StringUtils::format("seasonwin/b%d.png",currentSeason));    enermyren->setPosition(Vec2(visibleSize.width*2.5/10.0,visibleSize.height/2.0));    addChild(enermyren);        auto enermy = Sprite::create(StringUtils::format("seasonwin/reward.png",currentSeason));    enermy->setPosition(Vec2(visibleSize.width*5.0/10.0,visibleSize.height/2.0));    addChild(enermy);        bool isMale = UserDefault::getInstance()->getBoolForKey("male", true);    Sprite * hero;    if(isMale){        hero = Sprite::create("seasonwin/userboyhappy.png");    }else{        hero = Sprite::create("seasonwin/usergirlhappy.png");    }    hero->setPosition(Vec2(visibleSize.width*7.5/10,visibleSize.height/2.0));    addChild(hero);        auto backCastle = Button::create("seasonwin/continue.png");    backCastle->setPosition(Vec2(visibleSize.width*5.0/10.0,visibleSize.height*2.0/10.0));    backCastle->addTouchEventListener([&](Ref*pSender,Widget::TouchEventType type){        if(type==Widget::TouchEventType::ENDED){            if(count==1){                bool  isPlayMusic = UserDefault::getInstance()->getBoolForKey("music", true);                if(isPlayMusic){                    CocosDenshion::SimpleAudioEngine::getInstance()->stopBackgroundMusic();                    CocosDenshion::SimpleAudioEngine::getInstance()->preloadBackgroundMusic("xuqu.mp3");                    CocosDenshion::SimpleAudioEngine::getInstance()->playBackgroundMusic("xuqu.mp3", true);                }                  Director::getInstance()->replaceScene(Tail::createScene());                  Director::getInstance()->resume();            }else{                bool  isPlayMusic = UserDefault::getInstance()->getBoolForKey("music", true);                if(isPlayMusic){                    CocosDenshion::SimpleAudioEngine::getInstance()->stopBackgroundMusic();                    CocosDenshion::SimpleAudioEngine::getInstance()->preloadBackgroundMusic("xuqu.mp3");                    CocosDenshion::SimpleAudioEngine::getInstance()->playBackgroundMusic("xuqu.mp3", true);                }                  Director::getInstance()->resume();                Director::getInstance()->replaceScene(CastleScene::createScene());            }        }    });    addChild(backCastle);    int beanNumber = UserDefault::getInstance()->getIntegerForKey("bean",1);    if(beanNumber+50<9999){        beanNumber+=50;    }else{        beanNumber = 9999;    }    UserDefault::getInstance()->setIntegerForKey(StringUtils::format("true_max_level%d",currentSeason).c_str(), 13);    UserDefault::getInstance()->setIntegerForKey("bean", beanNumber);    UserDefault::getInstance()->flush();    return true;}